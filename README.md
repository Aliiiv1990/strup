# پلتفرم هوشمند و یکپارچه مدیریت واتساپ

## مقدمه

این پروژه یک سیستم نرم‌افزاری است که با هدف کمک به کسب‌وکارها و کاربران برای مدیریت کارآمدتر پیام‌ها، ارسال‌های زمان‌بندی شده و خودکارسازی پاسخ‌ها در پلتفرم واتساپ توسعه داده شده است. هدف اصلی، ارائه یک راهکار جامع برای بهبود تعاملات و ارتباطات از طریق واتساپ می‌باشد.

لازم به ذکر است که این پروژه در حال حاضر در مرحله توسعه قرار دارد و برخی از قابلیت‌های پیشرفته آن (مانند اتصال به API واقعی واتساپ و تحلیل دقیق زبان طبیعی) به صورت شبیه‌سازی شده پیاده‌سازی شده‌اند.

## قابلیت‌های کلیدی

در ادامه، قابلیت‌های اصلی که در ماژول‌های مختلف این سیستم توسعه داده شده‌اند، به صورت خلاصه توضیح داده می‌شوند:

*   **ماژول ۱: اتوماسیون ارسال محتوا و پیام‌رسانی**
    *   **مدیریت لیست مخاطبین:** امکان تعریف و دسته‌بندی مخاطبین در قالب لیست‌های مختلف.
    *   **زمان‌بندی ارسال پیام:** قابلیت تنظیم زمان مشخص برای ارسال پیام‌های از پیش تعریف‌شده به لیست‌های مخاطبین (مشابه پخش همگانی یا Broadcast).
    *   **شخصی‌سازی پیام‌ها:** امکان درج اطلاعات متغیر مانند نام مخاطب در متن پیام برای ایجاد حس شخصی‌تر.

*   **ماژول ۲: تحلیل داده و استخراج بینش (با قابلیت‌های شبیه‌سازی شده)**
    *   **ذخیره‌سازی پیام‌ها:** جمع‌آوری و آرشیو کردن تمامی پیام‌های ارسالی و دریافتی در پایگاه داده.
    *   **آمار پیام‌ها:** قابلیت شمارش و گزارش‌گیری از تعداد پیام‌های رد و بدل شده در بازه‌های زمانی مختلف.
    *   **تحلیل اولیه محتوا (شبیه‌سازی شده):** شناسایی و استخراج کلمات کلیدی که بیشتر در پیام‌ها تکرار شده‌اند.
    *   **تحلیل احساسات (شبیه‌سازی شده):** تشخیص اولیه حس کلی پیام‌های دریافتی (مثلا مثبت، منفی یا خنثی).

*   **ماژول ۳: پاسخگویی هوشمند و خودکار (با قابلیت‌های شبیه‌سازی شده)**
    *   **دریافت پیام‌ها:** قابلیت اتصال به واتساپ برای دریافت پیام‌های ارسال شده از سوی کاربران.
    *   **پاسخگویی بر اساس کلمات کلیدی:** امکان تعریف پاسخ‌های خودکار به پیام‌هایی که حاوی کلمات کلیدی خاصی هستند (مثلا پاسخ به "سلام" یا "وقت بخیر").
    *   **تشخیص اولیه هدف کاربر (شبیه‌سازی شده):** تلاش برای درک منظور اصلی کاربر از پیام (مثلا تشخیص اینکه کاربر در مورد وضعیت سفارش خود سوال می‌کند) و ارائه پاسخ اولیه مناسب.
    *   **پاسخ‌های متنوع:** قابلیت ارائه پاسخ‌های مختلف به یک نوع درخواست مشابه برای جلوگیری از تکرار و ایجاد تجربه بهتر برای کاربر.
    *   **یادداشت‌های مدیریت گفتگو (مفهومی):** پایه‌ریزی مفاهیم اولیه برای مدیریت گفتگوهای چند مرحله‌ای و حفظ زمینه صحبت با کاربر.

## نحوه عملکرد کلی سیستم (مفهومی)

عملکرد این سیستم به طور خلاصه به این صورت است:

1.  **اتصال و تنظیمات اولیه:** ابتدا لازم است تنظیمات اولیه برای اتصال سیستم به حساب کاربری واتساپ شما (از طریق پلتفرم توسعه‌دهندگان متا/فیسبوک) انجام شود.
2.  **تعریف داده‌ها:** شما می‌توانید لیست‌های مخاطبین خود را وارد کرده و محتوای پیام‌هایی که می‌خواهید ارسال شوند را تعریف کنید.
3.  **ارسال زمان‌بندی شده:** سیستم پیام‌های تنظیم شده را به صورت خودکار در زمان‌های مشخص شده برای مخاطبین ارسال می‌کند.
4.  **دریافت و پردازش پیام‌های ورودی:** هنگامی که پیامی از یک کاربر دریافت می‌شود، سیستم ابتدا تلاش می‌کند با استفاده از قوانین ساده و کلمات کلیدی تعریف‌شده، پاسخی مناسب ارائه دهد.
5.  **تشخیص هدف (شبیه‌سازی شده):** اگر پاسخ مستقیمی بر اساس کلمات کلیدی پیدا نشود، سیستم سعی می‌کند هدف کلی پیام کاربر را تشخیص داده و پاسخ مرتبط‌تری ارائه دهد.
6.  **گزارش‌گیری و تحلیل:** تمامی تعاملات ذخیره شده و می‌توان از آن‌ها برای تحلیل و بهبود فرآیندها استفاده کرد.

## پیش‌نیازهای فنی (برای راه‌اندازی فرضی)

برای استفاده واقعی و کامل از چنین سیستمی در محیط عملیاتی، پیش‌نیازهای زیر معمولا مورد نیاز خواهند بود:

*   **دسترسی به WhatsApp Business API:** این دسترسی از طریق ثبت‌نام و تایید در پلتفرم Meta for Developers امکان‌پذیر است.
*   **سرور:** یک سرور یا محیط هاستینگ برای نصب و اجرای مداوم برنامه.
*   **پایگاه داده:** برای ذخیره‌سازی اطلاعات مخاطبین، پیام‌ها، تنظیمات و لاگ‌ها (مثلا PostgreSQL یا MySQL).
*   **نصب کتابخانه‌های پایتون:** تمامی کتابخانه‌های پایتون که در این پروژه استفاده شده‌اند باید بر روی سرور نصب شوند.

## وضعیت فعلی پروژه

بخش‌های اصلی و منطق مرکزی برنامه برای قابلیت‌های ذکر شده پیاده‌سازی شده‌اند. با این حال، لازم است به نکات زیر توجه شود:

*   **اتصال به API واقعی واتساپ:** در حال حاضر، تعامل مستقیم با API واتساپ (برای ارسال و دریافت آنی پیام‌ها) انجام نشده است. بخش‌های مربوط به ارتباط با واتساپ با استفاده از شبیه‌سازها (Mock objects) پیاده‌سازی شده‌اند تا منطق برنامه قابل تست باشد.
*   **تحلیل پیشرفته متن (NLP):** قابلیت‌های مرتبط با تحلیل زبان طبیعی فارسی مانند استخراج دقیق کلمات کلیدی، تحلیل احساسات پیشرفته و تشخیص دقیق هدف کاربر، به صورت شبیه‌سازی شده و با قوانین ساده پیاده‌سازی شده‌اند. برای دستیابی به عملکرد دقیق و قابل اعتماد در این بخش‌ها، نیاز به ادغام با کتابخانه‌ها و مدل‌های واقعی NLP فارسی (مانند Hazm یا DadmaTools) و همچنین آموزش مدل‌های مناسب می‌باشد.
*   **رابط کاربری (UI):** در حال حاضر، سیستم فاقد رابط کاربری گرافیکی برای مدیریت آسان لیست مخاطبین، تعریف پیام‌ها، مشاهده گزارشات و تنظیمات دیگر است. تمامی تعاملات از طریق کد و اسکریپت‌ها انجام می‌شود.

## مراحل بعدی توسعه (بر اساس برنامه)

برخی از گام‌های مهم بعدی برای توسعه و تکمیل این پروژه عبارتند از:

*   **طراحی و پیاده‌سازی رابط کاربری (UI):** ایجاد یک داشبورد تحت وب یا دسکتاپ برای مدیریت آسان تمامی بخش‌های سیستم توسط کاربر نهایی.
*   **برنامه‌ریزی برای تست جامع و استقرار:** انجام تست‌های دقیق بر روی تمامی ماژول‌ها و آماده‌سازی سیستم برای استقرار در محیط عملیاتی.
*   **ادغام با کتابخانه‌های واقعی NLP فارسی:** جایگزینی بخش‌های شبیه‌سازی شده تحلیل متن با کتابخانه‌ها و مدل‌های قدرتمند پردازش زبان طبیعی فارسی.
*   **اتصال کامل به API واقعی واتساپ:** پیاده‌سازی ارتباط مستقیم با WhatsApp Business API برای ارسال و دریافت پیام‌ها در محیط واقعی.
*   **توسعه قابلیت مدیریت گفتگو (Dialog Management):** پیاده‌سازی سیستم مدیریت وضعیت گفتگو برای پشتیبانی از مکالمات چند مرحله‌ای با کاربران.

---
امیدواریم این توضیحات دید کلی مناسبی از پروژه و قابلیت‌های آن ارائه داده باشد.

## راهنمای راه‌اندازی سریع (نسخه آزمایشی و شبیه‌سازی شده)

این راهنما به شما کمک می‌کند تا نسخه فعلی و شبیه‌سازی شده این پلتفرم را روی سیستم خود اجرا کنید.

**۱. پیش‌نیازها:**
*   پایتون نسخه ۳.۷ یا بالاتر باید روی سیستم شما نصب باشد.
*   آشنایی اولیه با خط فرمان (ترمینال).

**۲. دریافت پروژه:**
*   اگر از سیستم کنترل نسخه Git استفاده می‌کنید، پروژه را `clone` کنید:
    ```bash
    git clone <آدرس-git-repository-پروژه>
    cd <پوشه-پروژه>
    ```
*   در غیر این صورت، فایل‌های پروژه را دانلود و در یک پوشه استخراج کنید.

**۳. نصب وابستگی‌ها:**
*   کتابخانه‌های اصلی مورد نیاز این پروژه Flask و SQLAlchemy هستند. برای نصب آن‌ها، در خط فرمان دستور زیر را اجرا کنید:
    ```bash
    pip install Flask SQLAlchemy python-dotenv
    ```
    *(`python-dotenv` برای مدیریت متغیرهای محیطی اضافه شد، هرچند در نسخه فعلی شبیه‌سازی شده، مقادیر پیش‌فرض در کد وجود دارد)*

**۴. تنظیم متغیرهای محیطی (اختیاری برای نسخه فعلی):**
*   برای یک برنامه واقعی، شما باید کلیدهای API و اطلاعات حساس را از طریق متغیرهای محیطی تنظیم کنید. یک فایل نمونه به نام `.env.example` می‌توانید ایجاد کنید:
    ```
    WHATSAPP_VERIFY_TOKEN="your_verify_token_here"
    WHATSAPP_APP_SECRET="your_app_secret_here"
    WHATSAPP_API_TOKEN="your_whatsapp_api_token_here"
    WHATSAPP_PHONE_NUMBER_ID="your_whatsapp_phone_number_id_here"
    DATABASE_URL="sqlite:///./whatsapp_platform.db" 
    ```
*   سپس این فایل را به `.env` تغییر نام داده و مقادیر واقعی را جایگزین کنید.
*   **نکته مهم برای نسخه فعلی:** در حال حاضر، مقادیر پیش‌فرض برای توکن‌ها و پایگاه داده در فایل `webhook_handler.py` و `database_setup.py` به صورت hardcode شده یا از مقادیر پیش‌فرض `os.getenv` استفاده می‌شود، بنابراین ایجاد فایل `.env` برای اجرای نسخه شبیه‌سازی شده الزامی نیست اما برای توسعه آینده توصیه می‌شود.

**۵. ساخت و مقداردهی اولیه پایگاه داده:**
*   پایگاه داده این برنامه از نوع SQLite است و فایل آن در ریشه پروژه با نام `whatsapp_platform.db` ایجاد خواهد شد.
*   برای ساخت جداول پایگاه داده، یک اسکریپت کوچک به نام `run_init_db.py` در ریشه پروژه ایجاد کنید (اگر وجود ندارد):
    ```python
    # run_init_db.py
    import os # Added import os
    from database_setup import init_db, get_db_session
    from database_models import Base # اطمینان از import شدن Base

    if __name__ == "__main__":
        db_url = os.getenv("DATABASE_URL", "sqlite:///./whatsapp_platform.db")
        engine = init_db(db_url)
        print(f"Database initialized with URL: {db_url}")
        print("Tables created (if they didn't exist).")

        # می‌توانید برای تست، چند داده اولیه نیز در اینجا اضافه کنید
        # from database_models import ContactList
        # session = get_db_session() # Note: get_db_session() doesn't take engine as arg in current setup
        # if not session.query(ContactList).first():
        #     new_list = ContactList(name="لیست تست اولیه")
        #     session.add(new_list)
        #     session.commit()
        #     print("Test data added to ContactList.")
        # session.close()
    ```
*   سپس اسکریپت را از طریق خط فرمان اجرا کنید:
    ```bash
    python run_init_db.py
    ```

**۶. اجرای برنامه اصلی:**
*   برنامه اصلی Flask در فایل `webhook_handler.py` قرار دارد. برای اجرای آن، دستور زیر را در خط فرمان وارد کنید:
    ```bash
    python webhook_handler.py
    ```
*   پس از اجرا، باید پیامی مشابه زیر مشاهده کنید که نشان می‌دهد سرور در حال اجرا است:
    ```
     * Serving Flask app 'webhook_handler'
     * Running on http://127.0.0.1:5000 (Press CTRL+C to quit)
    ```

**۷. دسترسی به رابط کاربری تحت وب:**
*   مرورگر وب خود را باز کنید و به آدرس `http://127.0.0.1:5000/` بروید.
*   از طریق منوی ناوبری می‌توانید به بخش‌های مختلف مانند داشبورد، مدیریت مخاطبین، ارسال‌های گروهی، قوانین چت‌بات و تحلیل‌ها دسترسی پیدا کنید.
*   تمام داده‌هایی که مشاهده می‌کنید، به صورت آزمایشی (Mock) در کد برنامه تعریف شده‌اند.

**۸. تست Webhook (مفهومی):**
*   اندپوینت `/webhook` برای دریافت پیام‌ها از واتساپ در نظر گرفته شده است. برای تست واقعی این بخش، نیاز به ابزارهایی مانند Postman (برای ارسال درخواست‌های نمونه) یا ngrok (برای عمومی کردن آدرس لوکال هاست خود جهت دریافت وب‌هوک از واتساپ) دارید.

**۹. نکته بسیار مهم:**
*   **این نسخه یک نمونه اولیه و شبیه‌سازی شده است.** قابلیت‌های کلیدی مانند اتصال واقعی به WhatsApp Business API، پردازش دقیق زبان طبیعی (NLP) برای تحلیل پیام و چت‌بات پیشرفته، و ذخیره‌سازی دائمی داده‌ها در پایگاه داده واقعی (فراتر از mockها و SQLite ساده) نیازمند توسعه و پیکربندی‌های بیشتر هستند. هدف اصلی این نسخه نمایش ساختار کلی و جریان کار پلتفرم است.

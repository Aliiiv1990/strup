{% extends "base.html" %}

{% block title %}مدیریت قوانین چت‌بات - پلتفرم واتساپ{% endblock %}

{% block content %}
<h1>مدیریت قوانین چت‌بات</h1>

<section class="form-section">
    <h2>{{ 'ویرایش قانون' if editing_rule else 'افزودن قانون جدید' }}</h2>
    <form method="POST" action="{{ url_for('save_chatbot_rule_route') }}">
        <input type="hidden" name="rule_id" value="{{ editing_rule.id if editing_rule else '' }}">
        
        <div class="form-group">
            <label for="rule_name">نام قانون:</label>
            <input type="text" name="rule_name" id="rule_name" value="{{ editing_rule.name if editing_rule else '' }}" required>
        </div>
        
        <div class="form-group">
            <label for="keywords">کلمات کلیدی (با کاما جدا شوند):</label>
            <textarea name="keywords" id="keywords" rows="3" required>{{ editing_rule.keywords_str if editing_rule else '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="response_text">متن پاسخ:</label>
            <textarea name="response_text" id="response_text" rows="4" required>{{ editing_rule.response_text if editing_rule else '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="match_type">نوع تطابق:</label>
            <select name="match_type" id="match_type">
                <option value="any" {% if editing_rule and editing_rule.match_type == 'any' %}selected{% endif %}>هر کلمه کلیدی (Any Keyword)</option>
                <option value="exact" {% if editing_rule and editing_rule.match_type == 'exact' %}selected{% endif %}>عبارت دقیق (Exact Phrase - شبیه‌سازی شده)</option>
                <!-- Add more match types as needed -->
            </select>
        </div>
        
        <div class="form-actions">
            <button type="submit">{{ 'ذخیره تغییرات' if editing_rule else 'افزودن قانون' }}</button>
            {% if editing_rule %}
                <a href="{{ url_for('chatbot_rules_route') }}" style="margin-left: 10px;">لغو ویرایش</a>
            {% endif %}
        </div>
    </form>
</section>

<section>
    <h2>لیست قوانین موجود</h2>
    {% if chatbot_rules_data %}
    <table>
        <thead>
            <tr>
                <th>نام قانون</th>
                <th>کلمات کلیدی</th>
                <th>متن پاسخ (خلاصه)</th>
                <th>نوع تطابق</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            {% for rule in chatbot_rules_data %}
            <tr>
                <td>{{ rule.name }}</td>
                <td>{{ rule.keywords_str }}</td>
                <td>{{ rule.response_text[:50] }}{% if rule.response_text|length > 50 %}...{% endif %}</td> {# Show snippet #}
                <td>{{ 'هر کلمه کلیدی' if rule.match_type == 'any' else 'عبارت دقیق' }}</td>
                <td class="actions">
                    <a href="{{ url_for('chatbot_rules_route', edit_rule_id=rule.id) }}">ویرایش</a> | 
                    <a href="#">حذف</a> {# Placeholder for delete action #}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>هنوز هیچ قانون چت‌باتی تعریف نشده است.</p>
    {% endif %}
</section>
{% endblock %}

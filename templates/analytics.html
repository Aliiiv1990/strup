{% extends "base.html" %}

{% block title %}تحلیل و گزارشات - پلتفرم واتساپ{% endblock %}

{% block content %}
<h1>تحلیل و گزارشات پلتفرم</h1>

<form method="GET" action="{{ url_for('analytics_route') }}" class="form-inline">
    <label for="start_date">از تاریخ:</label>
    <input type="date" name="start_date" id="start_date" value="{{ request_args.get('start_date', '') }}">
    <label for="end_date">تا تاریخ:</label>
    <input type="date" name="end_date" id="end_date" value="{{ request_args.get('end_date', '') }}">
    <button type="submit">اعمال فیلتر</button>
</form>

{% if analytics_data %}
    <section class="analytics-section">
        <h2>آمار پیام‌ها</h2>
        <p><strong>تعداد کل پیام‌های ارسالی:</strong> {{ analytics_data.message_counts.sent }}</p>
        <p><strong>تعداد کل پیام‌های دریافتی:</strong> {{ analytics_data.message_counts.received }}</p>
        <p><strong>مجموع کل پیام‌ها:</strong> {{ analytics_data.message_counts.total }}</p>
    </section>

    <section class="analytics-section">
        <h2>کلمات کلیدی پرتکرار</h2>
        {% if analytics_data.common_keywords and analytics_data.common_keywords|length > 0 %}
        <table>
            <thead>
                <tr>
                    <th>کلمه کلیدی</th>
                    <th>تعداد تکرار</th>
                </tr>
            </thead>
            <tbody>
                {% for kw, count in analytics_data.common_keywords %}
                <tr>
                    <td>{{ kw }}</td>
                    <td>{{ count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>داده‌ای برای کلمات کلیدی در این بازه زمانی موجود نیست.</p>
        {% endif %}
    </section>

    <section class="analytics-section">
        <h2>تحلیل احساسات کلی (شبیه‌سازی شده)</h2>
        {% if analytics_data.sentiment_overview %}
        <p><strong>پیام‌های مثبت:</strong> {{ analytics_data.sentiment_overview.positive }}</p>
        <p><strong>پیام‌های منفی:</strong> {{ analytics_data.sentiment_overview.negative }}</p>
        <p><strong>پیام‌های خنثی:</strong> {{ analytics_data.sentiment_overview.neutral }}</p>
        <div class="chart-placeholder">[نمودار توزیع احساسات - در آینده اضافه خواهد شد]</div>
        {% else %}
        <p>داده‌ای برای تحلیل احساسات در این بازه زمانی موجود نیست.</p>
        {% endif %}
    </section>
{% else %}
    <p>داده‌ای برای نمایش وجود ندارد. لطفا بازه زمانی را انتخاب و فیلتر کنید.</p>
{% endif %}
{% endblock %}
